{"ast":null,"code":"import _toConsumableArray from\"/Users/alanlee/Documents/Umich/webDev/debate-website/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/alanlee/Documents/Umich/webDev/debate-website/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import*as React from'react';import{useParams}from'react-router-dom';import{useState}from\"react\";import{useEffect}from\"react\";import{useRef}from\"react\";import App from'../App';import{useNavigate}from\"react-router-dom\";import Waiting from'../components/Waiting';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Message(props){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:props.content})});}var Room=function Room(){var _useParams=useParams(),roomName=_useParams.roomName;var _useParams2=useParams(),side=_useParams2.side;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),roomFull=_useState2[0],setRoomFull=_useState2[1];var chatSocket=useRef(null);var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setNewMessage=_useState4[1];var navigate=useNavigate();useEffect(function(){if(roomFull){var messageField=document.getElementsByClassName(\"messageField\")[0];messageField.scrollTo(0,messageField.scrollHeight+1000);}},[messages]);useEffect(function(){chatSocket.current=new WebSocket('ws://'+\"127.0.0.1:8000\"+'/ws/chat/'+roomName+'/');chatSocket.current.onmessage=function(e){console.log(\"message recieved\");var data=JSON.parse(e.data);if(data[\"type\"]==\"server\"){if(data[\"message\"][\"content\"]==\"room_full_status\"&&data[\"message\"][\"status\"]){setRoomFull(true);}else if(data[\"message\"][\"content\"]==\"DISCONNECT\"){navigate(\"/\");}}else{setNewMessage(function(messages){return[].concat(_toConsumableArray(messages),[data[\"message\"]]);});console.log(messages);}};chatSocket.current.onclose=function(e){console.log('Chat socket closed unexpectedly');navigate(\"/\");};},[]);var sendMessage=function sendMessage(){var messageInputDom=document.querySelector('#chat-message-input');var message=messageInputDom.value;if(message==\"\"){return;}chatSocket.current.send(JSON.stringify({'message':message}));messageInputDom.value='';};document.addEventListener(\"keypress\",function(event){// If the user presses the \"Enter\" key on the keyboard\nif(event.key===\"Enter\"){// Cancel the default action, if needed\nevent.preventDefault();// Trigger the button element with a click\ndocument.getElementById(\"submit\").click();}});if(roomFull){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"messagePanel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sideCover\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"middle\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[roomName,\" : \",side]}),/*#__PURE__*/_jsx(\"div\",{className:\"messageField\",children:/*#__PURE__*/_jsx(\"ul\",{children:messages.map(function(message,index){return/*#__PURE__*/_jsx(Message,{content:message},index);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"typeField\",children:[/*#__PURE__*/_jsx(\"input\",{id:\"chat-message-input\",type:\"text\",size:\"100\"}),/*#__PURE__*/_jsx(\"button\",{id:\"submit\",onClick:sendMessage,children:\"SUBMIT\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sideCover\"})]})});}else{return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(Waiting,{})});}};export default Room;","map":{"version":3,"names":["React","useParams","useState","useEffect","useRef","App","useNavigate","Waiting","Message","props","content","Room","roomName","side","roomFull","setRoomFull","chatSocket","messages","setNewMessage","navigate","messageField","document","getElementsByClassName","scrollTo","scrollHeight","current","WebSocket","onmessage","e","console","log","data","JSON","parse","onclose","sendMessage","messageInputDom","querySelector","message","value","send","stringify","addEventListener","event","key","preventDefault","getElementById","click","map","index"],"sources":["/Users/alanlee/Documents/Umich/webDev/debate-website/frontend/src/pages/Room.js"],"sourcesContent":["import * as React from 'react'\nimport { useParams } from 'react-router-dom'\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { useRef } from \"react\";\nimport App from '../App';\nimport { useNavigate } from \"react-router-dom\";\nimport Waiting from '../components/Waiting';\n\nfunction Message(props){\n    return <li><div className='message'>{props.content}</div></li>\n}\n\nconst Room = () =>{\n\n\n    const { roomName } = useParams()\n    const { side } = useParams()\n    const [roomFull, setRoomFull] = useState(false)\n\n    const chatSocket = useRef(null);\n\n    const [messages, setNewMessage] = useState([]);\n\n\n\n    const navigate = useNavigate();\n    useEffect(() =>{\n        if (roomFull){\n        const messageField = document.getElementsByClassName(\"messageField\")[0];\n        messageField.scrollTo(0,messageField.scrollHeight + 1000);\n        }\n    },[messages])\n\n    useEffect(() => {\n        chatSocket.current = new WebSocket(\n            'ws://'\n            + \"127.0.0.1:8000\"\n            + '/ws/chat/'\n            + roomName\n            + '/'\n        )\n        \n\n        chatSocket.current.onmessage = function(e) {\n            console.log(\"message recieved\")\n            let data = JSON.parse(e.data)\n            if (data[\"type\"] == \"server\"){\n                \n                if (data[\"message\"][\"content\"] == \"room_full_status\" && data[\"message\"][\"status\"]){\n                    setRoomFull(true)\n                }\n                else if (data[\"message\"][\"content\"] == \"DISCONNECT\"){\n                    navigate(\"/\")\n                }\n            }\n            else{\n                setNewMessage( messages => [...messages,data[\"message\"]])\n                \n\n                \n                console.log(messages)\n            }\n        }\n        chatSocket.current.onclose = function(e) {\n            console.log('Chat socket closed unexpectedly')\n            navigate(\"/\")\n        }\n    }, []);\n\n    let sendMessage = () => {\n        const messageInputDom = document.querySelector('#chat-message-input');\n        const message = messageInputDom.value;\n        if (message == \"\"){\n            return\n        }\n        \n        chatSocket.current.send(JSON.stringify({\n            'message': message\n        }));\n        messageInputDom.value = '';\n    };\n\n    document.addEventListener(\"keypress\", function(event) {\n        // If the user presses the \"Enter\" key on the keyboard\n        if (event.key === \"Enter\") {\n          // Cancel the default action, if needed\n          event.preventDefault();\n          // Trigger the button element with a click\n          document.getElementById(\"submit\").click();\n        }\n      });\n\n    if (roomFull){\n    return (\n        \n        <div className=\"App\">\n            \n            <div className = \"messagePanel\">\n                <div className='sideCover'></div>\n                <div className='middle'>\n                    <h1>{roomName} : {side}</h1>\n                    <div className='messageField'>\n                        <ul>\n                            {messages.map((message, index) => <Message key = {index} content = {message}/>)}\n                        </ul>\n                    </div>\n                    <div className= 'typeField'>\n                        <input id=\"chat-message-input\" type=\"text\" size=\"100\"></input>\n                        <button id = \"submit\" onClick={sendMessage}>SUBMIT</button>\n                    </div>\n                    \n                </div>\n                <div className='sideCover'></div>\n            </div>\n           \n        </div>\n    )    \n    }\n    else{\n        return (\n        <div className=\"App\"> \n            <Waiting/>\n        </div>)\n    }\n}   \n\nexport default Room;"],"mappings":"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"},"metadata":{},"sourceType":"module"}